<script type="module">
  /* 1 ‚Äì decode ?p=‚Ä¶ ---------------------------------------------------- */
  const enc = new URLSearchParams(location.search).get('p') ?? '';
  if (!enc) { document.body.textContent = 'Áº∫Â∞ëÂèÉÊï∏'; throw new Error('no p'); }
  const { cfg, amt, tno } = JSON.parse(atob(decodeURIComponent(enc)));

  /* 2 ‚Äì build the form -------------------------------------------------- */
  const p = {
    MerchantID       : cfg.merchantId,
    MerchantTradeNo  : tno,
    MerchantTradeDate: new Date().toISOString().slice(0,19).replace('T',' '),
    PaymentType      : 'aio',
    TotalAmount      : amt,
    TradeDesc        : 'Ë™≤Á®ãË®ÇÂñÆ',
    ItemName         : 'Ë™≤Á®ã',
    ReturnURL        : 'https://www.sooooz.com/_functions/updateECPayTransaction',
    ClientBackURL    : 'https://www.sooooz.com/',
    OrderResultURL   : 'https://www.sooooz.com/_functions/paymentResult',
    ChoosePayment    : 'ALL',
    EncryptType      : '1',
    CustomField1     : cfg.wixTransactionId,
    CustomField2     : cfg.orderId,
    CheckMacValue    : cfg.mac                  /* üëà already computed */
  };

  /* 3 ‚Äì dump to console for debugging */
  console.table(p);

  /* 4 ‚Äì inject & auto-submit */
  const form = document.getElementById('pay');
  for (const [k,v] of Object.entries(p)){
    const inp = document.createElement('input');
    inp.type='hidden'; inp.name=k; inp.value=v; form.appendChild(inp);
  }
  form.submit();                                 // auto-submit
</script>
